<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Play - Math Challenge</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: linear-gradient(120deg, #952c0f 0%, #3c119191 100%);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      background: rgba(255,255,255,0.18);
      box-shadow: 0 8px 32px 0 rgba(31,38,135,0.37);
      backdrop-filter: blur(12px);
      border-radius: 24px;
      border: 1.5px solid rgba(255,255,255,0.28);
      max-width: 400px;
      width: 90%;
      padding: 40px 32px 32px 32px;
      text-align: center;
      margin: 40px auto;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    h1 {
      font-size: 2em;
      color: #fff;
      margin-bottom: 18px;
      text-shadow: 0 0 12px #218ba999;
    }
    .coin-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      font-weight: bold;
      color: #ffd700;
      margin-bottom: 18px;
      gap: 8px;
    }
    .coin-bar img {
      width: 28px;
      vertical-align: middle;
    }
    #timer-bar-bg {
      width: 100%;
      height: 16px;
      background: #e0e0e0;
      border-radius: 8px;
      margin-bottom: 18px;
      overflow: hidden;
      box-shadow: 0 2px 8px #005bea33;
    }
    #timer-bar {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%);
      transition: width 0.2s linear;
    }
    #game {
      font-size: 1.5em;
      margin-bottom: 16px;
      color: #fff;
      font-weight: bold;
    }
    #answer {
      padding: 10px;
      font-size: 1.1em;
      border-radius: 8px;
      border: 1px solid #2193b0;
      margin-bottom: 10px;
      width: 60%;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }
    button {
      padding: 12px 24px;
      font-size: 1.1em;
      border: none;
      border-radius: 10px;
      background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 6px;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px #2193b055;
    }
    button:hover {
      background: linear-gradient(90deg, #af1acd 0%, #12966c 100%);
      transform: scale(1.04);
    }
    #message {
      min-height: 24px;
      margin: 10px 0 0 0;
      font-size: 1.1em;
      font-weight: bold;
      color: #fff;
    }
    #powers {
      margin: 20px 0 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    #powers button {
      font-size: 0.9em;
      margin: 5px;
      padding: 8px 14px;
    }
    #footer {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ Playing Math Game</h1>
    <div class="coin-bar">
      <img src="https://cdn-icons-png.flaticon.com/512/138/138292.png" alt="coin" />
      <span id="coin-count">0</span> Maths Coins
    </div>
    <div id="timer-bar-bg">
      <div id="timer-bar"></div>
    </div>
    <div id="game">Loading...</div>
    <input type="text" id="answer" placeholder="Your Answer" autocomplete="off" onkeydown="if(event.key==='Enter'){submitAnswer();}">
    <button onclick="submitAnswer()">Submit</button>
    <p id="message"></p>
    <div id="powers"></div>
    <div id="footer">
      <button onclick="endGame()">üè† End Game</button>
    </div>
  </div>

  <script>
    let score = 0;
    let answer = 0;
    let timer;
    let timeLeft = 10;
    const maxTime = 10;
    let doubleCoinsActive = false;
    let freezeActive = false;

    let questionCount = parseInt(localStorage.getItem("questionCount")) || 0;
    let difficulty = parseInt(localStorage.getItem("difficulty")) || 1;

    let player = JSON.parse(localStorage.getItem("player") || "{}");
    player.powers = player.powers || {};
    player.coins = player.coins || 0;

    function updatePowers() {
      document.getElementById("powers").innerHTML = `
        <button onclick="usePower('extraTime')" ${player.powers.extraTime ? '' : 'disabled'}>‚è≥ Extra Time (${player.powers.extraTime || 0})</button>
        <button onclick="usePower('doubleCoins')" ${player.powers.doubleCoins ? '' : 'disabled'}>üí∏ Double Coins (${player.powers.doubleCoins || 0})</button>
        <button onclick="usePower('hint')" ${player.powers.hint ? '' : 'disabled'}>üí° Hint (${player.powers.hint || 0})</button>
        <button onclick="usePower('skip')" ${player.powers.skip ? '' : 'disabled'}>‚è≠Ô∏è Skip (${player.powers.skip || 0})</button>
        <button onclick="usePower('freeze')" ${player.powers.freeze ? '' : 'disabled'}>üßä Freeze (${player.powers.freeze || 0})</button>
      `;
    }

    function usePower(power) {
      if (!player.powers[power]) return;
      player.powers[power]--;
      switch(power) {
        case 'extraTime':
          timeLeft += 5;
          if (timeLeft > maxTime) timeLeft = maxTime;
          updateTimerBar();
          break;
        case 'doubleCoins':
          doubleCoinsActive = true;
          document.getElementById("message").textContent = "üí∏ Double Coins active!";
          break;
        case 'hint':
          document.getElementById("message").textContent = `üí° Hint: Answer is ${answer}`;
          break;
        case 'skip':
          document.getElementById("message").textContent = "‚è≠Ô∏è Skipped!";
          setTimeout(newQuestion, 800);
          return;
        case 'freeze':
          freezeActive = true;
          clearInterval(timer);
          document.getElementById("message").textContent = "üßä Timer frozen for 5 seconds!";
          setTimeout(() => {
            freezeActive = false;
            startTimer();
          }, 5000);
          return;
      }
      localStorage.setItem("player", JSON.stringify(player));
      updatePowers();
    }

    function updateTimerBar() {
      const percent = (timeLeft / maxTime) * 100;
      const bar = document.getElementById("timer-bar");
      bar.style.width = percent + "%";
      if (percent > 60) {
        bar.style.background = "linear-gradient(90deg, #43cea2 0%, #185a9d 100%)";
      } else if (percent > 30) {
        bar.style.background = "linear-gradient(90deg, #ffd700 0%, #ff9800 100%)";
      } else {
        bar.style.background = "linear-gradient(90deg, #ff4e50 0%, #f9d423 100%)";
      }
    }

    function startTimer() {
      if (freezeActive) return;
      timeLeft = maxTime;
      updateTimerBar();
      clearInterval(timer);
      timer = setInterval(() => {
        if (!freezeActive) {
          timeLeft--;
          updateTimerBar();
          if (timeLeft <= 0) {
            clearInterval(timer);
            document.getElementById("message").textContent = `‚è∞ Time's up! Answer was ${answer}`;
            setTimeout(newQuestion, 1200);
          }
        }
      }, 1000);
    }

    function newQuestion() {
      doubleCoinsActive = false;

      questionCount++;
      localStorage.setItem("questionCount", questionCount);

      if (questionCount % 20 === 0) {
        difficulty++;
        if (difficulty > 3) difficulty = 3;
        localStorage.setItem("difficulty", difficulty);
        alert(`üî• Difficulty Increased to Level ${difficulty}!`);
      }

      let n1, n2;
      if (difficulty === 1) {
        n1 = Math.floor(Math.random() * 10 + 1);
        n2 = Math.floor(Math.random() * 10 + 1);
      } else if (difficulty === 2) {
        n1 = Math.floor(Math.random() * 50 + 10);
        n2 = Math.floor(Math.random() * 50 + 10);
      } else {
        n1 = Math.floor(Math.random() * 100 + 50);
        n2 = Math.floor(Math.random() * 50 + 1);
      }

      const types = ["+", "-", "√ó", "√∑"];
      const op = types[Math.floor(Math.random() * types.length)];

      let questionText = "";
      switch (op) {
        case "+":
          answer = n1 + n2;
          questionText = `${n1} + ${n2}`;
          break;
        case "-":
          answer = n1 >= n2 ? n1 - n2 : n2 - n1;
          questionText = n1 >= n2 ? `${n1} - ${n2}` : `${n2} - ${n1}`;
          break;
        case "√ó":
          answer = n1 * n2;
          questionText = `${n1} √ó ${n2}`;
          break;
        case "√∑":
          answer = n1;
          const dividend = n1 * n2;
          questionText = `${dividend} √∑ ${n1}`;
          break;
      }

      document.getElementById("game").textContent = questionText + " = ?";
      document.getElementById("answer").value = "";
      document.getElementById("message").textContent = "";
      updatePowers();
      startTimer();
    }

    function submitAnswer() {
      const input = document.getElementById("answer");
      const userAnswer = parseFloat(input.value);

      if (userAnswer === answer) {
        const earned = doubleCoinsActive ? 20 : 10;
        player.coins += earned;
        score += 1;
        document.getElementById("coin-count").textContent = player.coins;
        document.getElementById("message").textContent = `‚úÖ Correct! +${earned} coins`;
      } else {
        document.getElementById("message").textContent = `‚ùå Wrong! Answer was ${answer}`;
      }

      localStorage.setItem("player", JSON.stringify(player));
      clearInterval(timer);
      setTimeout(newQuestion, 1000);
    }

    function endGame() {
      clearInterval(timer);
      let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
      leaderboard.push({ name: player.name, score: score });
      leaderboard.sort((a, b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 5);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
      localStorage.setItem("player", JSON.stringify(player));
      window.location.href = "index.html";
    }

    document.getElementById("coin-count").textContent = player.coins || 0;
    updatePowers();
    newQuestion();
  </script>
</body>
</html>
